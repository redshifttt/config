#!/usr/bin/python

# TODO: go through filetypes and figure out sizes of files

from os import scandir, getcwd
from sys import argv

def count_visible_filetypes(working_directory):
    filetypes = []
    seen = {}

    for f in scandir(working_directory):
        if f.is_dir():
            filetypes.append("directory/")

        if not "." in f.name:
            continue

        if f.name.startswith("."):
            continue

        filetypes.append(f.name.split(".")[-1:][0])

    for t in filetypes:
        if not t in seen:
            seen[t] = 0 # init in dict
            seen[t] += 1 # you have been seen
            continue

        seen[t] += 1

    sum_of_values = sum(seen.values())

    for k in seen:
        v = seen[k]
        seen[k] = str(v)

    seen = sorted(seen.items(), key=lambda x: x[1], reverse=True)

    type_width = 0
    for k,v in seen:
        if len(k) > type_width:
            type_width = len(k) + 1
    if seen:
        amount_width = len(seen[0][1]) + 1
    else:
        return

    for v in seen:
        bar = "#" * int(v[1])
        print(f"{v[0]:<{type_width}}{v[1]:>{amount_width}} {bar}")

cwd = getcwd()

if len(argv) == 2:
    cwd = argv[1]

count_visible_filetypes(cwd)
